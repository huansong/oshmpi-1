/* -*- Mode: C; c-basic-offset:4 ; -*- */
/*
 * (C) 2018 by Argonne National Laboratory.
 *     See COPYRIGHT in top-level directory.
 */

#ifndef OSHMPI_SHMEM_H
#define OSHMPI_SHMEM_H

#include <stdio.h>
#include <stdlib.h>
#include <stdint.h>
#include <string.h>
#include <stddef.h>
#include <mpi.h>

/* OSHMPI_VERSION is the version string. OSHMPI_NUMVERSION is the
 * numeric version that can be used in numeric comparisons.
 *
 * OSHMPI_VERSION uses the following format:
 * Version: [MAJ].[MIN].[REV][EXT][EXT_NUMBER]
 * Example: 1.0.7rc1 has
 *          MAJ = 1
 *          MIN = 0
 *          REV = 7
 *          EXT = rc
 *          EXT_NUMBER = 1
 *
 * OSHMPI_NUMVERSION will convert EXT to a format number:
 *          ALPHA (a) = 0
 *          BETA (b)  = 1
 *          RC (rc)   = 2
 *          PATCH (p) = 3
 * Regular releases are treated as patch 0
 *
 * Numeric version will have 1 digit for MAJ, 2 digits for MIN, 2
 * digits for REV, 1 digit for EXT and 2 digits for EXT_NUMBER. So,
 * 1.0.7rc1 will have the numeric version 10007201.
 */
#define OSHMPI_VERSION "@OSHMPI_VERSION@"
#define OSHMPI_NUMVERSION @OSHMPI_NUMVERSION@
#define OSHMPI_RELEASE_DATE "@OSHMPI_RELEASE_DATE@"
#define OSHMPI_BUILD_INFO "@CONFIGURE_ARGS_CLEAN@"

#define  SHMEM_MAJOR_VERSION 1
#define _SHMEM_MAJOR_VERSION SHMEM_MAJOR_VERSION
#define  SHMEM_MINOR_VERSION 4
#define _SHMEM_MINOR_VERSION SHMEM_MINOR_VERSION
#define  SHMEM_MAX_NAME_LEN  256
#define _SHMEM_MAX_NAME_LEN  SHMEM_MAX_NAME_LEN
#define  SHMEM_VENDOR_STRING "OSHMPI"
#define _SHMEM_VENDOR_STRING SHMEM_VENDOR_STRING

#define SHMEM_THREAD_SINGLE MPI_THREAD_SINGLE
#define SHMEM_THREAD_FUNNELED MPI_THREAD_FUNNELED
#define SHMEM_THREAD_SERIALIZED MPI_THREAD_SERIALIZED
#define SHMEM_THREAD_MULTIPLE MPI_THREAD_MULTIPLE

#define SHMEM_CTX_DEFAULT -1
typedef int shmem_ctx_t;

/* -- Library Setup, Exit, and Query Routines -- */
void shmem_init(void);
int shmem_my_pe(void);
int shmem_n_pes(void);
void shmem_finalize(void);
void shmem_global_exit(int status);
int shmem_pe_accessible(int pe);
int shmem_addr_accessible(const void *addr, int pe);
void *shmem_ptr(const void *dest, int pe);
void shmem_info_get_version(int *major, int *minor);
void shmem_info_get_name(char *name);
/* (deprecated APIs) */
void start_pes(int npes);
int _my_pe(void);
int _num_pes(void);

/* -- Thread Support -- */
void shmem_init_thread(int requested, int *provided);
void shmem_query_thread(int *provided);

/* -- Memory Management -- */
void *shmem_malloc(size_t size);
void shmem_free(void *ptr);
void *shmem_realloc(void *ptr, size_t size);
void *shmem_align(size_t alignment, size_t size);
void *shmem_calloc(size_t count, size_t size);
/* (deprecated APIs) */
void *shmalloc(size_t size);
void shfree(void *ptr);
void *shrealloc(void *ptr, size_t size);
void *shmemalign(size_t alignment, size_t size);

/* -- RMA and Atomics -- */
void shmem_ctx_putmem(shmem_ctx_t ctx, void *dest, const void *source, size_t nelems, int pe);
void shmem_putmem(void *dest, const void *source, size_t nelems, int pe);
void shmem_ctx_getmem(shmem_ctx_t ctx, void *dest, const void *source, size_t nelems, int pe);
void shmem_getmem(void *dest, const void *source, size_t nelems, int pe);

/* SHMEM_RMA_TYPED_H start */
/* SHMEM_RMA_TYPED_H end */

/* SHMEM_RMA_SIZED_H start */
/* SHMEM_RMA_SIZED_H end */

/* SHMEM_AMO_STD_TYPED_H start */
/* SHMEM_AMO_STD_TYPED_H end */

/* SHMEM_AMO_EXT_TYPED_H start */
/* SHMEM_AMO_EXT_TYPED_H end */

/* SHMEM_AMO_BITWS_TYPED_H start */
/* SHMEM_AMO_BITWS_TYPED_H end */

/* -- Collectives -- */
void shmem_barrier_all(void);
void shmem_barrier(int PE_start, int logPE_stride, int PE_size, long *pSync);
void shmem_sync_all(void);
void shmem_sync(int PE_start, int logPE_stride, int PE_size, long *pSync);
void shmem_broadcast32(void *dest, const void *source, size_t nelems, int PE_root, int PE_start,
                       int logPE_stride, int PE_size, long *pSync);
void shmem_broadcast64(void *dest, const void *source, size_t nelems, int PE_root, int PE_start,
                       int logPE_stride, int PE_size, long *pSync);
void shmem_collect32(void *dest, const void *source, size_t nelems, int PE_start, int logPE_stride,
                     int PE_size, long *pSync);
void shmem_collect64(void *dest, const void *source, size_t nelems, int PE_start, int logPE_stride,
                     int PE_size, long *pSync);
void shmem_fcollect32(void *dest, const void *source, size_t nelems, int PE_start, int logPE_stride,
                      int PE_size, long *pSync);
void shmem_fcollect64(void *dest, const void *source, size_t nelems, int PE_start, int logPE_stride,
                      int PE_size, long *pSync);
void shmem_alltoall32(void *dest, const void *source, size_t nelems, int PE_start, int logPE_stride,
                      int PE_size, long *pSync);
void shmem_alltoall64(void *dest, const void *source, size_t nelems, int PE_start, int logPE_stride,
                      int PE_size, long *pSync);
void shmem_alltoalls32(void *dest, const void *source, ptrdiff_t dst, ptrdiff_t sst, size_t nelems,
                       int PE_start, int logPE_stride, int PE_size, long *pSync);
void shmem_alltoalls64(void *dest, const void *source, ptrdiff_t dst, ptrdiff_t sst, size_t nelems,
                       int PE_start, int logPE_stride, int PE_size, long *pSync);

/* SHMEM_REDUCE_MINMAX_TYPED_H start */
/* SHMEM_REDUCE_MINMAX_TYPED_H end */

/* SHMEM_REDUCE_SUMPROD_TYPED_H start */
/* SHMEM_REDUCE_SUMPROD_TYPED_H end */

/* SHMEM_REDUCE_BITWS_TYPED_H start */
/* SHMEM_REDUCE_BITWS_TYPED_H end */

#endif /* OSHMPI_SHMEM_H */
